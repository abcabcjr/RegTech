<!doctype html>
<html class="no-js" lang="{{ request.locale.iso_code }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="">
    <link rel="canonical" href="{{ canonical_url }}">

    {%- if settings.favicon != blank -%}
      <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32 }}">
    {%- endif -%}

    {%- unless settings.type_header_font.system? and settings.type_body_font.system? -%}
      <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    {%- endunless -%}

    <title>
      {{ page_title }}
      {%- if current_tags %} &ndash; {{ 'general.meta.tags' | t: tags: current_tags | join: ', ' }}{% endif -%}
      {%- if current_page != 1 %} &ndash; {{ 'general.meta.page' | t: page: current_page }}{% endif -%}
      {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
    </title>

    {% if page_description %}
      <meta name="description" content="{{ page_description | escape }}">
    {% endif %}

    {% render 'meta-tags' %}

    <!-- ðŸ”´ VULNERABILITY 1: Hardcoded API Keys in Meta Tags -->
    <meta name="shopify-api-key" content="sk_live_demo_vulnerable_12345678901234567890">
    <meta name="webhook-secret" content="whsec_demo_vulnerable_secret_abcdef123456">
    <meta name="private-app-token" content="shppa_demo_vulnerable_token_xyz789012345">

    <script src="{{ 'constants.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'pubsub.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'global.js' | asset_url }}" defer="defer"></script>

    <!-- ðŸ”´ VULNERABILITY 2: Exposed Configuration in JavaScript -->
    <script>
      // INTENTIONALLY VULNERABLE - FOR DEMO PURPOSES ONLY
      window.SHOPIFY_VULNERABLE_CONFIG = {
        api_key: "4a8b2c1d9e7f3g6h5i4j3k2l1m0n9o8p7q6r5s4t",
        secret_key: "shpss_demo_vulnerable_secret_1234567890abcdef",
        access_token: "shpat_demo_vulnerable_access_token_abcdefghijk",
        webhook_secret: "webhook_demo_vulnerable_secret_12345678901234567890",
        shop_domain: "{{ shop.domain }}",
        shop_id: "{{ shop.id }}",
        customer_id: "{{ customer.id | default: 'guest' }}",
        
        // Third-party integrations with exposed keys
        integrations: {
          stripe_public_key: "pk_live_demo_vulnerable_stripe_key_123456789",
          mailchimp_api_key: "demo123456789abcdef-us1",
          sendgrid_api_key: "SG.demo_vulnerable_sendgrid_key.xyz789",
          facebook_pixel_id: "1234567890123456",
          google_analytics_id: "UA-12345678-1",
          klaviyo_public_key: "pk_demo_vulnerable_klaviyo_12345"
        },
        
        // Database and internal system info
        internal: {
          database_host: "db-vulnerable-demo.internal.com",
          admin_email: "admin@vulnerable-demo.myshopify.com",
          support_email: "support@regtech-security-demo.com",
          internal_api_endpoint: "https://api-internal.vulnerable-demo.com/v1"
        }
      };

      // BAD: Encode secrets (still easily detectable)
      var encodedApiKey = btoa("shopify_api_key_demo_vulnerable_encode_test_12345");
      var rot13Secret = "fubcvsl_frperg_qrzb_ihyarenoyr_123456".replace(/[a-zA-Z]/g, function(c){
        return String.fromCharCode((c<="Z"?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26);
      });

      console.log("ðŸ”´ SECURITY DEMO: Shopify store initialized with exposed credentials");
      console.log("API Key:", window.SHOPIFY_VULNERABLE_CONFIG.api_key);
      console.log("This is intentional for security testing purposes only!");
    </script>

    <!-- ðŸ”´ VULNERABILITY 3: Open Redirect Handling -->
    <script>
      // VULNERABLE: Unvalidated redirect functionality
      document.addEventListener('DOMContentLoaded', function() {
        var urlParams = new URLSearchParams(window.location.search);
        
        // Multiple vulnerable redirect parameters
        var redirectTo = urlParams.get('redirect') || 
                         urlParams.get('return_to') || 
                         urlParams.get('next') || 
                         urlParams.get('callback') ||
                         urlParams.get('redirect_url') ||
                         urlParams.get('url') ||
                         urlParams.get('goto');
        
        if (redirectTo) {
          console.log("ðŸ”´ OPEN REDIRECT DETECTED: Redirecting to:", redirectTo);
          
          // Show warning banner for demo purposes
          var banner = document.createElement('div');
          banner.style.cssText = 'position:fixed;top:0;left:0;right:0;background:#ff4444;color:white;padding:10px;text-align:center;z-index:9999;';
          banner.innerHTML = 'ðŸš¨ SECURITY DEMO: Open redirect to ' + redirectTo + ' (redirecting in 3 seconds)';
          document.body.insertBefore(banner, document.body.firstChild);
          
          // VULNERABLE: No validation of redirect URL
          setTimeout(function() {
            window.location.href = redirectTo;
          }, 3000);
        }
      });
    </script>

    {{ content_for_header }}

    <script>document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
    if (Shopify.designMode) {
      document.documentElement.classList.add('shopify-design-mode');
    }
    </script>
  </head>

  <body class="gradient">
    <!-- ðŸ”´ VULNERABILITY 4: Sensitive Data in HTML Comments -->
    <!--
    DEVELOPMENT DEBUG INFO (REMOVE BEFORE PRODUCTION):
    
    Shopify Store Configuration:
    - Store ID: {{ shop.id }}
    - Domain: {{ shop.domain }}
    - API Version: 2023-01
    - Private App Key: shppa_demo_vulnerable_private_app_xyz789
    - Webhook Endpoint: https://backend-vulnerable-demo.com/shopify/webhook
    - Webhook Secret: whsec_demo_vulnerable_webhook_secret_abc123
    
    Database Configuration:
    - Host: mysql-vulnerable-demo.internal.com:3306
    - Database: shopify_vulnerable_demo_db
    - Username: shop_admin_demo
    - Password: demo_vulnerable_password_123
    
    Customer Service:
    - Support Email: support@vulnerable-demo-store.com
    - Admin Panel: https://vulnerable-demo.myshopify.com/admin
    - Emergency Contact: security@regtech-demo.com
    
    Payment Gateway:
    - Stripe Secret Key: sk_live_demo_vulnerable_stripe_secret_xyz789
    - PayPal Client ID: demo_paypal_client_vulnerable_12345
    -->

    <a class="skip-to-content-link button visually-hidden" href="#MainContent">
      {{ "accessibility.skip_to_text" | t }}
    </a>

    {%- liquid
      assign main_menu = linklists[section.settings.menu].links
    -%}

    <!-- Header -->
    <header class="header">
      <div class="header__inner">
        <h1 class="header__heading">
          <a href="{{ routes.root_url }}">
            {{ shop.name }}
          </a>
        </h1>
        
        <!-- ðŸ”´ VULNERABILITY 5: Exposed Customer Data -->
        {% if customer %}
        <div class="customer-debug" style="display:none;">
          <!-- VULNERABLE: Customer data exposed in HTML -->
          <script>
            // Customer information exposed for "debugging"
            window.CUSTOMER_DEBUG_INFO = {
              id: {{ customer.id | json }},
              email: {{ customer.email | json }},
              first_name: {{ customer.first_name | json }},
              last_name: {{ customer.last_name | json }},
              phone: {{ customer.phone | json }},
              accepts_marketing: {{ customer.accepts_marketing | json }},
              created_at: {{ customer.created_at | json }},
              last_order: {% if customer.last_order %}{{ customer.last_order.id | json }}{% else %}null{% endif %},
              total_spent: {{ customer.total_spent | money | json }},
              orders_count: {{ customer.orders_count | json }},
              tags: {{ customer.tags | json }},
              addresses: [
                {% for address in customer.addresses limit: 3 %}
                {
                  address1: {{ address.address1 | json }},
                  address2: {{ address.address2 | json }},
                  city: {{ address.city | json }},
                  province: {{ address.province | json }},
                  zip: {{ address.zip | json }},
                  country: {{ address.country | json }},
                  phone: {{ address.phone | json }}
                }{% unless forloop.last %},{% endunless %}
                {% endfor %}
              ]
            };
            console.log("ðŸ”´ CUSTOMER DATA EXPOSURE:", window.CUSTOMER_DEBUG_INFO);
          </script>
        </div>
        {% endif %}

        <nav class="header__nav">
          <ul class="list-unstyled">
            {% for link in main_menu %}
              <li><a href="{{ link.url }}">{{ link.title }}</a></li>
            {% endfor %}
          </ul>
        </nav>
      </div>
    </header>

    <main id="MainContent" class="content-for-layout focus-none" role="main" tabindex="-1">
      {{ content_for_layout }}
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer__content">
        <p>&copy; {{ 'now' | date: "%Y" }} {{ shop.name }}. {{ 'general.footer.powered_by_html' | t }}</p>
        
        <!-- ðŸ”´ VULNERABILITY 6: Additional Secrets in Footer -->
        <script>
          // More integration keys for comprehensive testing
          var ADDITIONAL_VULNERABLE_KEYS = {
            // Social media APIs
            twitter_api_key: "demo_twitter_api_vulnerable_123456789",
            instagram_token: "IGQVJXdemo_vulnerable_instagram_token_xyz789",
            youtube_api_key: "AIzaDemo_Vulnerable_YouTube_API_Key_123456",
            
            // Analytics and tracking
            mixpanel_token: "demo_vulnerable_mixpanel_token_abcdef123456",
            segment_write_key: "demo_vulnerable_segment_write_key_xyz789",
            hotjar_id: "1234567",
            
            // Email and messaging
            twilio_auth_token: "demo_vulnerable_twilio_auth_token_123456",
            postmark_token: "demo_vulnerable_postmark_server_token_abc",
            
            // CDN and storage
            aws_access_key_id: "AKIADEMO_VULNERABLE_AWS_KEY_123",
            cloudinary_api_secret: "demo_vulnerable_cloudinary_secret_xyz789"
          };
          
          // Simulate usage to make it look more realistic
          if (typeof gtag !== 'undefined') {
            gtag('config', ADDITIONAL_VULNERABLE_KEYS.google_analytics_id);
          }
        </script>
      </div>
    </footer>

    <!-- ðŸ”´ VULNERABILITY 7: Form with CSRF Issues -->
    <div id="vulnerable-contact-form" style="display:none;">
      <form action="/contact" method="post" accept-charset="UTF-8">
        <!-- MISSING: CSRF token -->
        <input type="hidden" name="form_type" value="contact">
        <input type="hidden" name="utf8" value="âœ“">
        
        <!-- Vulnerable: No validation on redirect parameter -->
        <input type="hidden" name="return_to" value="{{ request.url | append: '?submitted=true' }}">
        
        <script>
          // Auto-populate form with potentially sensitive data
          document.addEventListener('DOMContentLoaded', function() {
            var urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('auto_fill_demo')) {
              // Simulate pre-filling with exposed customer data
              console.log("ðŸ”´ AUTO-FILLING FORM WITH CUSTOMER DATA (DEMO)");
            }
          });
        </script>
      </form>
    </div>

    <div id="shopify-section-cart-notification" class="shopify-section">
      <!-- Cart notification content -->
    </div>

    <!-- ðŸ”´ VULNERABILITY 8: PostMessage Security Issues -->
    <script>
      // VULNERABLE: Overly permissive postMessage listener
      window.addEventListener('message', function(event) {
        console.log("ðŸ”´ POSTMESSAGE RECEIVED:", event.data);
        
        // VULNERABLE: No origin validation
        if (event.data && event.data.action) {
          switch(event.data.action) {
            case 'redirect':
              // No validation of URL
              window.location.href = event.data.url;
              break;
            case 'set_config':
              // Allow external sites to modify config
              if (event.data.config) {
                Object.assign(window.SHOPIFY_VULNERABLE_CONFIG, event.data.config);
              }
              break;
            case 'execute_script':
              // EXTREMELY DANGEROUS: Execute arbitrary code
              if (event.data.script) {
                eval(event.data.script);
              }
              break;
          }
        }
      });
      
      console.log("ðŸ”´ SECURITY DEMO: PostMessage listeners active (no origin validation)");
    </script>

    <ul hidden>
      <li id="a11y-refresh-page-message">{{ 'accessibility.refresh_page' | t }}</li>
    </ul>

    <script>
      window.shopUrl = '{{ routes.root_url }}';
      window.routes = {
        cart_add_url: '{{ routes.cart_add_url }}',
        cart_change_url: '{{ routes.cart_change_url }}',
        cart_update_url: '{{ routes.cart_update_url }}',
        predictive_search_url: '{{ routes.predictive_search_url }}'
      };

      window.cartStrings = {
        error: `{{ 'sections.cart.cart_error' | t }}`,
        quantityError: `{{ 'sections.cart.cart_quantity_error_html' | t: quantity: '[quantity]' }}`
      }

      window.variantStrings = {
        addToCart: `{{ 'products.product.add_to_cart' | t }}`,
        soldOut: `{{ 'products.product.sold_out' | t }}`,
        unavailable: `{{ 'products.product.unavailable' | t }}`,
      }

      console.log("ðŸ”´ SHOPIFY THEME LOADED WITH INTENTIONAL VULNERABILITIES");
      console.log("This theme contains multiple security issues for demonstration purposes:");
      console.log("- Hardcoded API keys and secrets");
      console.log("- Open redirect vulnerabilities"); 
      console.log("- Information disclosure in comments");
      console.log("- Customer data exposure");
      console.log("- CSRF vulnerabilities");
      console.log("- PostMessage security issues");
    </script>
  </body>
</html>